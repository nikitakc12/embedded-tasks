CREATE TABLE Student (
    student_id INTEGER PRIMARY KEY,
    student_name TEXT NOT NULL,
    major TEXT
);

CREATE TABLE Course (
    course_id INTEGER PRIMARY KEY,
    course_name TEXT NOT NULL,
    course_description TEXT,
    credits INTEGER
);

CREATE TABLE Assignment (
    assignment_id INTEGER PRIMARY KEY,
    assignment_name TEXT NOT NULL,
    course_id INTEGER,
    FOREIGN KEY(course_id) REFERENCES Course(course_id)
);

CREATE TABLE Task (
    task_id INTEGER PRIMARY KEY,
    task_name TEXT NOT NULL,
    assignment_id INTEGER,
    FOREIGN KEY(assignment_id) REFERENCES Assignment(assignment_id)
);

CREATE TABLE Completion (
    completion_id INTEGER PRIMARY KEY,
    task_id INTEGER,
    student_id INTEGER,
    completion_time TEXT,
    FOREIGN KEY(task_id) REFERENCES Task(task_id),
    FOREIGN KEY(student_id) REFERENCES Student(student_id)
);

CREATE TABLE Grade (
    student_id INTEGER,
    course_id INTEGER,
    grade REAL,
    PRIMARY KEY(student_id, course_id),
    FOREIGN KEY(student_id) REFERENCES Student(student_id),
    FOREIGN KEY(course_id) REFERENCES Course(course_id)
);

-- ==========================
-- 2️⃣ Insert Sample Data
-- ==========================
-- Students
INSERT INTO Student VALUES (1,'Alice','CS');
INSERT INTO Student VALUES (2,'Bob','Math');
INSERT INTO Student VALUES (3,'Charlie','Physics');
INSERT INTO Student VALUES (4,'David','Chemistry');

-- Courses
INSERT INTO Course VALUES (1,'Databases','Learn about databases',3);
INSERT INTO Course VALUES (2,'Algebra','Linear Algebra course',4);
INSERT INTO Course VALUES (3,'Physics 101','Intro to Physics',3);
INSERT INTO Course VALUES (4,'Chemistry 101','Basic Chemistry',3);

-- Assignments
INSERT INTO Assignment VALUES (1,'DB Assignment 1',1);
INSERT INTO Assignment VALUES (2,'Algebra Assignment 1',2);
INSERT INTO Assignment VALUES (3,'Physics Assignment 1',3);

-- Tasks
INSERT INTO Task VALUES (1,'Task A',1);
INSERT INTO Task VALUES (2,'Task B',1);
INSERT INTO Task VALUES (3,'Task C',2);
INSERT INTO Task VALUES (4,'Task D',3);

-- Completions
INSERT INTO Completion VALUES (1,1,1,'2025-01-05'); -- late
INSERT INTO Completion VALUES (2,2,1,'2024-12-20'); -- on time
INSERT INTO Completion VALUES (3,3,2,'2025-01-02'); -- late
INSERT INTO Completion VALUES (4,4,3,'2024-12-15'); -- on time

-- Grades
INSERT INTO Grade VALUES (1,1,85);
INSERT INTO Grade VALUES (2,2,90);
INSERT INTO Grade VALUES (3,3,75);

-- ==========================
-- 3️⃣ Queries
-- ==========================

-- 1. Show assignment ID, task name, and course name
SELECT 
    A.assignment_id,
    T.task_name,
    C.course_name
FROM Assignment A
JOIN Task T ON A.assignment_id = T.assignment_id
JOIN Course C ON A.course_id = C.course_id;

-- 2. List all assignments with related tasks and courses
SELECT
    A.assignment_id,
    A.assignment_name,
    T.task_name,
    C.course_name
FROM Assignment A
LEFT JOIN Task T ON A.assignment_id = T.assignment_id
LEFT JOIN Course C ON A.course_id = C.course_id;

-- 3. Show all completions with assignment details and task names
SELECT
    CO.completion_id,
    CO.completion_time,
    A.assignment_id,
    T.task_name
FROM Completion CO
JOIN Task T ON CO.task_id = T.task_id
JOIN Assignment A ON T.assignment_id = A.assignment_id;

-- 4. Show student name, course name, grade, and credits
SELECT
    S.student_name,
    C.course_name,
    G.grade,
    C.credits
FROM Grade G
JOIN Student S ON G.student_id = S.student_id
JOIN Course C ON G.course_id = C.course_id;

-- 5. Show student name, task name, and completion time
SELECT
    S.student_name,
    T.task_name,
    CO.completion_time
FROM Completion CO
JOIN Student S ON CO.student_id = S.student_id
JOIN Task T ON CO.task_id = T.task_id;

-- 6. Display course name and count of assignments
SELECT
    C.course_name,
    COUNT(A.assignment_id) AS assignment_count
FROM Course C
LEFT JOIN Assignment A ON C.course_id = A.course_id
GROUP BY C.course_id, C.course_name;

-- 7. Courses without assignments
SELECT
    C.course_name,
    C.course_description
FROM Course C
LEFT JOIN Assignment A ON C.course_id = A.course_id
WHERE A.assignment_id IS NULL;

-- 8. Assignments completed late (after '2025-01-01')
SELECT
    A.assignment_id,
    T.task_name,
    CO.completion_time
FROM Completion CO
JOIN Task T ON CO.task_id = T.task_id
JOIN Assignment A ON T.assignment_id = A.assignment_id
WHERE CO.completion_time > '2025-01-01';

-- 9. Students missing credits
SELECT
    S.student_name,
    S.major
FROM Student S
LEFT JOIN Grade G ON S.student_id = G.student_id
WHERE G.student_id IS NULL;

-- 10. Course Performance Summary
SELECT
    C.course_name,
    COUNT(G.student_id) AS total_students,
    AVG(G.grade) AS average_grade,
    SUM(C.credits) AS total_credits_earned
FROM Course C
LEFT JOIN Grade G ON C.course_id = G.course_id
GROUP BY C.course_id, C.course_name;
